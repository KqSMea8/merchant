webpackJsonp([11],{1038:function(a,e,t){"use strict";(function(a){function r(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(e,"__esModule",{value:!0});var n=t(229),s=r(n),i=t(100),d=r(i);e.default={name:"settings-bank-card",data:function(){var a=this;return{columns:[{title:"银行卡号",key:"bankCardNumber"},{title:"银行名称",key:"bankName"},{title:"开户行",key:"bankDeposit"},{title:"开户名/持卡人姓名",key:"username"},{title:"操作",key:"action",width:130,align:"center",render:function(e,t){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){a.showEdit(t.index)}}},"修改"),e("Button",{props:{type:"error",size:"small"},on:{click:function(){a.remove(t.index)}}},"删除")])}}],saveType:"new",tableData:[],isTableDataDataReady:!1,currentData:{id:0,bankCardNumber:"",bankName:"",bankDeposit:"",bankAddress:"",username:"",bank_id:0},bankList:[],save_loading:!1,editModal:!1,savePassLoading:!1,currentDataValidate:{bank_id:[{required:!0,type:"number",message:"请选择银行",trigger:"blur"}],bankCardNumber:[{required:!0,message:"请输入银行卡号",trigger:"blur"}],bankDeposit:[{required:!0,message:"请输入开户行",trigger:"blur"}],username:[{required:!0,message:"请输入开户名/持卡人姓名",trigger:"blur"}]}}},computed:{isadd:function(){return this.tableData.length<3&&this.isTableDataDataReady}},methods:{remove:function(e){var t=this;if(this.tableData[e].id){a.ajax({url:s.default.api.setting.UserBankCard.deleteBankCard,type:"POST",dataType:"json",data:function(){return{ssid:d.default.get("ssid"),id:t.tableData[e].id}}()}).done(function(a){a?0==a.code?(t.$Message.success("成功删除银行卡 "),t.tableData.splice(e,1)):a.code==s.default.errorCode.runOut.num?t.$store.commit("logout",t):t.$Message.error(a.message):t.$Message.error("删除银行卡失败 "+status)}).fail(function(a,e,r){t.$Message.error("删除银行卡失败 "+e)})}},addBankCard:function(){this.currentData={id:null,bankCardNumber:"",bankName:"",bankDeposit:"",bankAddress:"",username:"",bank_id:null},this.saveType="new",this.editModal=!0},showEdit:function(e){this.currentData=a.extend(!0,{},this.tableData[e]),this.currentData.dataIndex=e,this.saveType="edit",this.editModal=!0},cancelEdit:function(){this.editModal=!1},saveEdit:function(){var e=this;this.$refs.currentData.validate(function(t){if(t){e.save_loading=!0;var r=(e.currentData.bank_id,e.currentData.bankName);e.currentData.bank_id>0&&(r=e.bankList[e.currentData.bank_id].bank_name,e.currentData.bankName=r);var n={ssid:d.default.get("ssid"),bank_id:e.currentData.bank_id,name:r,opening_bank:e.currentData.bankDeposit,number:e.currentData.bankCardNumber,username:e.currentData.username};"new"==e.saveType&&(n.id=e.currentData.id);var i="new"==e.saveType?s.default.api.setting.UserBankCard.addBankCard:s.default.api.setting.UserBankCard.modifyBankCard,o="new"==e.saveType?"添加":"修改";a.ajax({url:i,type:"POST",dataType:"json",data:n}).done(function(t){if(e.save_loading=!1,t)if(0==t.code){if(e.$Message.success("成功"+o+"银行卡信息！"),"new"==e.saveType)e.tableData.push(e.currentData);else{var r=a.extend(!0,{},e.currentData),n=a.extend(!0,[],e.tableData);n.splice(e.currentData.dataIndex,1,r),e.tableData=n}e.cancelEdit()}else s.default.showError({vm:e,data:t,errorMsg:""});else s.default.showError({vm:e,data:t,errorMsg:"数据获取失败"})}).fail(function(a,t,r){e.save_loading=!1,s.default.showError({vm:e,data:data,errorMsg:""})})}})},setBankList:function(){var e=this;a.ajax({url:s.default.api.public.bankList,type:"POST",dataType:"json",data:function(){return{ssid:d.default.get("ssid")}}()}).done(function(a){if(a)if(0==a.code){var t=[];for(var r in a.data)for(var n in a.data[r])t[a.data[r][n].bank_id]=a.data[r][n];e.bankList=t}else s.default.showError({vm:e,data:a,errorMsg:""});else s.default.showError({vm:e,data:a,errorMsg:""})}).fail(function(a,t,r){s.default.showError({vm:e,data:data,errorMsg:""})})},init:function(){var e=this;a.ajax({url:s.default.api.setting.UserBankCard.getBankCardList,type:"POST",dataType:"json",data:function(){return{ssid:d.default.get("ssid")}}()}).done(function(a){if(a)if(0==a.code){var t=[];for(var r in a.data)t.push({id:a.data[r].id,bankCardNumber:a.data[r].number,bankName:a.data[r].name,bankDeposit:a.data[r].opening_bank,bankAddress:"",username:a.data[r].username,created:a.data[r].created,bank_id:a.data[r].bank_id});e.tableData=t,e.isTableDataDataReady=!0}else s.default.showError({vm:e,data:a,errorMsg:""});else s.default.showError({vm:e,data:a,errorMsg:"数据获取失败"})}).fail(function(a,t,r){s.default.showError({vm:e,data:data,errorMsg:"服务器通讯失败"})})}},mounted:function(){this.setBankList()},activated:function(){this.init()}}}).call(e,t(230))},1061:function(a,e){},1103:function(a,e,t){a.exports={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",[t("Card",[t("p",{attrs:{slot:"title"},slot:"title"},[t("Icon",{attrs:{type:"person"}}),a._v("\n            绑定银行卡\n        ")],1),a._v(" "),t("div",[a.isadd?t("div",{staticClass:"do-contact"},[t("Button",{attrs:{type:"primary",size:"small"},on:{click:a.addBankCard}},[a._v("添加银行卡")]),a._v(" "),t("span",{staticClass:"card-explain"},[a._v("备注：每个商户最多只能添加三张银行卡，用于提现！")])],1):a._e(),a._v(" "),t("Table",{attrs:{border:"",columns:a.columns,data:a.tableData}})],1)]),a._v(" "),t("Modal",{attrs:{"class-name":"vertical-center-modal",closable:!1,"mask-closable":!1,width:550},model:{value:a.editModal,callback:function(e){a.editModal=e},expression:"editModal"}},[t("h3",{staticStyle:{color:"#2D8CF0"},attrs:{slot:"header"},slot:"header"},[a._v("修改银行卡信息")]),a._v(" "),t("Form",{ref:"currentData",attrs:{model:a.currentData,"label-width":146,"label-position":"right",rules:a.currentDataValidate}},[t("FormItem",{attrs:{label:"银行名称",prop:"bank_id"}},[t("Select",{attrs:{filterable:""},model:{value:a.currentData.bank_id,callback:function(e){a.$set(a.currentData,"bank_id",e)},expression:"currentData.bank_id"}},a._l(a.bankList,function(e,r){return e?t("Option",{key:e.bank_id,attrs:{value:e.bank_id}},[a._v(a._s(e.bank_name))]):a._e()}))],1),a._v(" "),t("FormItem",{attrs:{label:"银行卡号",prop:"bankCardNumber"}},[t("Input",{attrs:{placeholder:"请输入银行卡号"},model:{value:a.currentData.bankCardNumber,callback:function(e){a.$set(a.currentData,"bankCardNumber",e)},expression:"currentData.bankCardNumber"}})],1),a._v(" "),t("FormItem",{attrs:{label:"开户行",prop:"bankDeposit"}},[t("Input",{attrs:{placeholder:"请输入完整的开户行名称，包含省市信息"},model:{value:a.currentData.bankDeposit,callback:function(e){a.$set(a.currentData,"bankDeposit",e)},expression:"currentData.bankDeposit"}})],1),a._v(" "),t("FormItem",{attrs:{label:"开户名/持卡人姓名",prop:"username"}},[t("Input",{attrs:{placeholder:"请输入开户名/持卡人姓名"},model:{value:a.currentData.username,callback:function(e){a.$set(a.currentData,"username",e)},expression:"currentData.username"}})],1)],1),a._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("Button",{attrs:{type:"text"},on:{click:a.cancelEdit}},[a._v("取消")]),a._v(" "),t("Button",{attrs:{type:"primary",loading:a.save_loading},on:{click:a.saveEdit}},[a._v("保存")])],1)],1)],1)},staticRenderFns:[]},a.exports.render._withStripped=!0},989:function(a,e,t){t(1061);var r=t(65)(t(1038),t(1103),null,null);r.options.__file="E:\\BigCousin\\document\\预购宝\\merchant\\src\\views\\settings\\bank-card.vue",r.esModule&&Object.keys(r.esModule).some(function(a){return"default"!==a&&"__esModule"!==a})&&console.error("named exports are not supported in *.vue files."),r.options.functional&&console.error("[vue-loader] bank-card.vue: functional components are not supported with templates, they should use render functions."),a.exports=r.exports}});